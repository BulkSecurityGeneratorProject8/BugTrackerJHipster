# Editing the front end (Angular)

<walkthrough-tutorial-duration duration="10">
</walkthrough-tutorial-duration>

In this guide, we will make our own Angular component in order to display the logged user's tickets.


## Tooling

Angular is using TypeScript instead of JavaScript, and as a result some specific tooling is necessary
to work efficiently with it. Our development workflow for an Angular 2+ application is as below, use 
instead of yarn if you prefer that.

1. When you generate an application, the files are created and at the end of generation npm install task is triggered.
2. Once npm install is complete it calls the postInstall script in package.json, this step triggers the webpack:build task.
3. Now you should have all files generated and compiled into the www folder inside the target or build folder based on the build tool (Maven or Gradle) selected.
4. Now run **./mvnw** to launch the application server and it should be available at localhost:8080 this also serves the client side code compiled from the above steps.
```bash
./mvnw
```
5. Now run **npm start** or **yarn start** in a new terminal to launch Webpack dev-server with BrowserSync. This will take care of compiling your TypeScript code, and automatically reloading your browser.
```bash
npm start
```
6. Click on `walkthrough web-preview-icon` and watch the port **9000**. Now any change on your front end will be reflected here.

If you start making changes to the client side code without having **npm start** or **yarn start** running, nothing will be reflected as the changes are not compiled so you need to either run npm run webpack:build manually after changes or have npm start or yarn start running.  
More at the [JHipster website](https://www.jhipster.tech/using-angular/).

## Updating the service
Now that we have installed the environment for Angular development, we will update the default
TicketService generated by JHipster and add a new method that call and retrieve the query we made earlier with
Spring Data in the back end.

1. Open <walkthrough-editor-open-file filePath="BugTrackerJHipster/src/main/webapp/app/entities/ticket/ticket.service.ts">ticket.service.ts</walkthrough-editor-open-file>

2. Add the following method.
```Typescript
queryMyTickets(): Observable<EntityArrayResponseType> {
    const options = createRequestOption();
    return this.http
        .get<ITicket[]>(this.resourceUrl + '/self', { params: options, observe: 'response' })
        .pipe(map((res: EntityArrayResponseType) => this.convertDateArrayFromServer(res)));
}
```

Calling `queryMyTickets()` will send a HTTP request to the Rest Controller and will return all
the tickets associated to the connected user.

## Adding our new components (1/3)
Let's make our Angular component called mytickets.

1. Install the command-line interface tool Angular CLI
```bash
npm install -g @angular/cli
```

2. Go to the Angular root project
```bash
cd ~/BugTrackerJHipster/src/main/webapp/app
```

3. Generate the new component mytickets
```bash
ng generate component mytickets
```

4. Go to the generated component
```bash
cd mytickets
```

5. Replace <walkthrough-editor-open-file filePath="BugTrackerJHipster/src/main/webapp/app/mytickets/mytickets.component.html">mytickets.component.html</walkthrough-editor-open-file> with the following content.
```html
<h2 id="page-heading">
    <span>Assigned tickets</span>
</h2>
<jhi-alert></jhi-alert>
<br/>
<div class="table-responsive" *ngIf="tickets">
    <table class="table table-striped">
        <thead>
        <tr jhiSort [(predicate)]="predicate" [(ascending)]="reverse">
            <th jhiSortBy="id"><span jhiTranslate="global.field.id">ID</span>
                <fa-icon [icon]="'sort'"></fa-icon>
            </th>
            <th jhiSortBy="title"><span jhiTranslate="bugTrackerJHipsterApp.ticket.title">Title</span>
                <fa-icon [icon]="'sort'"></fa-icon>
            </th>
            <th jhiSortBy="description"><span jhiTranslate="bugTrackerJHipsterApp.ticket.description">Description</span>
                <fa-icon [icon]="'sort'"></fa-icon>
            </th>
            <th jhiSortBy="dueDate"><span jhiTranslate="bugTrackerJHipsterApp.ticket.dueDate">Due Date</span>
                <fa-icon [icon]="'sort'"></fa-icon>
            </th>
            <th jhiSortBy="done"><span jhiTranslate="bugTrackerJHipsterApp.ticket.done">Done</span>
                <fa-icon [icon]="'sort'"></fa-icon>
            </th>
            <th jhiSortBy="project.name"><span
                jhiTranslate="bugTrackerJHipsterApp.ticket.project">Project</span>
                <fa-icon [icon]="'sort'"></fa-icon>
            </th>
            <th jhiSortBy="assignedTo.login"><span jhiTranslate="bugTrackerJHipsterApp.ticket.assignedTo">Assigned To</span>
                <fa-icon [icon]="'sort'"></fa-icon>
            </th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let ticket of tickets">
            <td><a [routerLink]="['/ticket', ticket.id, 'view' ]">{{ticket.id}}</a></td>
            <td>{{ticket.title}}</td>
            <td>{{ticket.description}}</td>
            <td>{{ticket.dueDate | date:'mediumDate'}}</td>
            <td>{{ticket.done}}</td>
            <td>
                <div *ngIf="ticket.project">
                    <a [routerLink]="['../project', ticket.project?.id, 'view' ]">{{ticket.project?.name}}</a>
                </div>
            </td>
            <td>
                {{ticket.assignedTo?.login}}
            </td>
            <td class="text-right">
                <div class="btn-group flex-btn-group-container">
                    <button type="submit"
                            [routerLink]="['/ticket', ticket.id, 'view' ]"
                            class="btn btn-info btn-sm">
                        <fa-icon [icon]="'eye'"></fa-icon>
                        <span class="d-none d-md-inline" jhiTranslate="entity.action.view">View</span>
                    </button>
                    <button type="submit"
                            [routerLink]="['/ticket', ticket.id, 'edit']"
                            class="btn btn-primary btn-sm">
                        <fa-icon [icon]="'pencil-alt'"></fa-icon>
                        <span class="d-none d-md-inline" jhiTranslate="entity.action.edit">Edit</span>
                    </button>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>
```


## Adding our new components (2/3)


6. Replace <walkthrough-editor-open-file filePath="BugTrackerJHipster/src/main/webapp/app/mytickets/mytickets.component.ts">mytickets.component.ts</walkthrough-editor-open-file> with the following content.

```Typescript
import { Component, OnInit } from '@angular/core';
import { ITicket } from 'app/shared/model/ticket.model';
import { Subscription } from 'rxjs';
import { TicketService } from 'app/entities/ticket';
import { JhiAlertService, JhiEventManager, JhiParseLinks } from 'ng-jhipster';
import { AccountService } from 'app/core';
import { HttpErrorResponse, HttpHeaders, HttpResponse } from '@angular/common/http';

@Component({
    selector: 'jhi-mytickets',
    templateUrl: './mytickets.component.html',
    styles: []
})
export class MyticketsComponent implements OnInit {
    tickets: ITicket[];

    account: Account;
    eventSubscriber: Subscription;
    predicate: any;
    reverse: any;
    links: any;
    totalItems: any;

    constructor(
        private accountService: AccountService,
        private ticketService: TicketService,
        private jhiAlertService: JhiAlertService,
        private eventManager: JhiEventManager,
        private parseLinks: JhiParseLinks
    ) {}

    ngOnInit() {
        this.loadSelf();
        this.accountService.identity().then((account: Account) => {
            this.account = account;
        });
        this.registerChangeInTickets();
    }

    loadSelf() {
        this.ticketService
            .queryMyTickets()
            .subscribe(
                (res: HttpResponse<ITicket[]>) => this.paginateTickets(res.body, res.headers),
                (res: HttpErrorResponse) => this.onError(res.message)
            );
    }

    sort() {
        const result = [this.predicate + ',' + (this.reverse ? 'asc' : 'desc')];
        if (this.predicate !== 'id') {
            result.push('id');
        }
        return result;
    }

    protected paginateTickets(data: ITicket[], headers: HttpHeaders) {
        this.links = this.parseLinks.parse(headers.get('link'));
        this.totalItems = parseInt(headers.get('X-Total-Count'), 10);
        this.tickets = data;
    }

    protected onError(errorMessage: string) {
        this.jhiAlertService.error(errorMessage, null, null);
    }

    registerChangeInTickets() {
        this.eventSubscriber = this.eventManager.subscribe('ticketListModification', response => this.loadSelf());
    }
}

```

## Adding our new component (3/3)
Now, let's add the new component to the navigation bar, in order to let user to access it.

1. Open <walkthrough-editor-open-file filePath="BugTrackerJHipster/src/main/webapp/app/layouts/navbar/navbar.component.html">navbar.component.html</walkthrough-editor-open-file>.

2. Add the following content right after the "home" button code.
```html
            <li class="nav-item" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" *ngSwitchCase="true">
                <a class="nav-link" routerLink="jhi-mytickets" (click)="collapseNavbar()">
                    <span>
                        <fa-icon icon="th-list"></fa-icon>
                        <span>MyTickets</span>
                    </span>
                </a>
            </li>
```

Finally, we have to configure the route for our new component.

1. Open <walkthrough-editor-open-file filePath="BugTrackerJHipster/src/main/webapp/app/app-routing.module.ts">app-routing.module.ts</walkthrough-editor-open-file>.

2. Add the new component in the router module.
```TypeScript
                {
                    path: 'jhi-mytickets',
                    component: MyticketsComponent
                }

```

Do not forget to import MyTicketsComponent in the app-routing.module.ts file.
```typescript
import { MyticketsComponent } from 'app/mytickets/mytickets.component';
```

The file should look like this:
```typescript
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { errorRoute, navbarRoute } from './layouts';
import { DEBUG_INFO_ENABLED } from 'app/app.constants';
import { MyticketsComponent } from 'app/mytickets/mytickets.component';

const LAYOUT_ROUTES = [navbarRoute, ...errorRoute];

@NgModule({
    imports: [
        RouterModule.forRoot(
            [
                {
                    path: 'jhi-mytickets',
                    component: MyticketsComponent
                },
                {
                    path: 'admin',
                    loadChildren: './admin/admin.module#BugTrackerJHipsterAdminModule'
                },
                ...LAYOUT_ROUTES
            ],
            { useHash: true, enableTracing: DEBUG_INFO_ENABLED }
        )
    ],
    exports: [RouterModule]
})
export class BugTrackerJHipsterAppRoutingModule {}
```

## Checking out the result
Let's check our new component.

1. Log as Administrator (login="admin" and password="admin"), you should be able to see 
"MyTickets".

2. Click on MyTickets and there you have your component !
However this should be empty since we have not created any entities.

3. Create a Project and 2 tickets: one assigned to the Administrator and one for an User.

4. Click on MyTickets, you should see only one ticket assigned to the Administrator.


<walkthrough-conclusion-trophy></walkthrough-conclusion-trophy>

Congratulations! You now know how to edit your front !

Enter the next command line to start the next tutorial:

```bash
cloudshell launch-tutorial -d ~/jhipster-guides/guides/07_testing_your_application.md;
```